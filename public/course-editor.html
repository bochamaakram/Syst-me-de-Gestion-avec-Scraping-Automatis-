<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Editor | knowway</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/output.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <a href="learning.html" class="navbar-brand">knowway</a>
            <ul class="navbar-nav">
                <li><a href="explore.html">Explore</a></li>
                <li><a href="in-person.html">In-Person</a></li>
                <li><a href="learning.html">My Learning</a></li>
            </ul>
            <div class="navbar-user" id="navbarUser"></div>
        </div>
    </nav>

    <div id="loadingState" class="empty-state">
        <div class="spinner"></div>
    </div>

    <div id="accessDenied" class="access-denied hidden">
        <h2>Access Denied</h2>
        <p>Only teachers and admins can create courses.</p>
        <a href="learning.html" class="btn btn-primary btn-lg">Go to Home</a>
    </div>

    <div id="mainContent" class="hidden">
        <section class="page-hero">
            <div class="container">
                <h1>Course Editor</h1>
                <p>Create and manage your courses</p>
            </div>
        </section>

        <main class="container">
            <div class="manage-layout">
                <div>
                    <div class="sidebar-list">
                        <div class="sidebar-header">
                            <span class="sidebar-title">My Courses</span>
                            <button class="btn btn-primary btn-sm" onclick="showCourseForm()">+ New</button>
                        </div>
                        <div id="coursesList"></div>
                    </div>
                </div>

                <div>
                    <div id="welcomePanel" class="editor-panel" style="text-align:center;padding:var(--space-2xl)">
                        <h2 style="margin-bottom:var(--space-md)">Welcome!</h2>
                        <p style="color:var(--text-secondary);margin-bottom:var(--space-lg)">Select a course to edit or
                            create a new one</p>
                        <button class="btn btn-primary" onclick="showCourseForm()">Create New Course</button>
                    </div>

                    <div id="courseFormPanel" class="editor-panel hidden">
                        <div class="editor-header">
                            <h2 class="editor-title" id="courseFormTitle">New Course</h2>
                            <button class="btn btn-secondary btn-sm" onclick="cancelCourseForm()">Cancel</button>
                        </div>
                        <form id="courseForm">
                            <input type="hidden" id="courseId">
                            <div class="form-group">
                                <label class="form-label">Title *</label>
                                <input type="text" id="courseTitle" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Short Description</label>
                                <input type="text" id="courseShortDesc" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea id="courseDesc" class="form-control" rows="3"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select id="courseCategory" class="form-control">
                                        <option value="dev">Development</option>
                                        <option value="design">Design</option>
                                        <option value="marketing">Marketing</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Level</label>
                                    <select id="courseLevel" class="form-control">
                                        <option value="beginner">Beginner</option>
                                        <option value="intermediate">Intermediate</option>
                                        <option value="advanced">Advanced</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" style="display:flex;align-items:center;gap:var(--space-sm)">
                                    <input type="checkbox" id="courseFree" checked onchange="togglePointsFields()">
                                    Free Course
                                </label>
                            </div>
                            <div id="pointCostGroup" class="form-group" style="display:none">
                                <label class="form-label">Point Cost</label>
                                <input type="number" id="coursePointCost" class="form-control" value="2000" min="0"
                                    step="100">
                                <small style="color:var(--text-muted)">How many points users need to enroll</small>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Points Reward</label>
                                    <input type="number" id="coursePointsReward" class="form-control" value="500"
                                        min="0">
                                    <small style="color:var(--text-muted)">Points earned on completion (free courses
                                        only)</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Duration (hours)</label>
                                    <input type="number" id="courseDuration" class="form-control" value="1" min="0">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cover Image URL</label>
                                <input type="url" id="courseImage" class="form-control">
                            </div>
                            <button type="submit" class="btn btn-primary">Save Course</button>
                        </form>
                    </div>

                    <div id="lessonsPanel" class="editor-panel hidden">
                        <div class="editor-header">
                            <h2 class="editor-title">Lessons: <span id="currentCourseName"></span></h2>
                            <div>
                                <button class="btn btn-secondary btn-sm" onclick="showQuizEditor()">Manage Quiz</button>
                                <button class="btn btn-secondary btn-sm" onclick="editCurrentCourse()">Edit
                                    Course</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteCurrentCourse()">Delete</button>
                            </div>
                        </div>
                        <div id="lessonsList" class="lessons-section"></div>
                        <button class="add-lesson-btn" onclick="addNewLesson()">+ Add Lesson</button>
                    </div>

                    <div id="lessonFormPanel" class="editor-panel hidden">
                        <div class="editor-header">
                            <h2 class="editor-title" id="lessonFormTitle">New Lesson</h2>
                            <button class="btn btn-secondary btn-sm" onclick="cancelLessonForm()">Cancel</button>
                        </div>
                        <form id="lessonForm">
                            <input type="hidden" id="lessonId">
                            <div class="form-group">
                                <label class="form-label">Lesson Title *</label>
                                <input type="text" id="lessonTitle" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Video URL (optional)</label>
                                <input type="url" id="lessonVideo" class="form-control"
                                    placeholder="YouTube or Vimeo URL">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Content</label>
                                <p style="font-size:12px;color:var(--text-muted);margin-bottom:var(--space-sm)">Write
                                    your lesson content using Markdown. Use **bold**, *italic*, # headings,
                                    ![image](url)</p>
                                <textarea id="lessonContent" class="form-control lesson-content-editor"
                                    rows="12"></textarea>
                            </div>
                            <div class="lesson-actions">
                                <button type="submit" class="btn btn-primary">Save Lesson</button>
                                <button type="button" class="btn btn-danger" id="deleteLessonBtn" style="display:none"
                                    onclick="deleteCurrentLesson()">Delete Lesson</button>
                            </div>
                        </form>
                    </div>

                    <div id="quizEditorPanel" class="editor-panel hidden">
                        <div class="editor-header">
                            <h2 class="editor-title">Quiz Editor</h2>
                            <button class="btn btn-secondary btn-sm" onclick="cancelQuizForm()">Cancel</button>
                        </div>
                        <form id="quizForm">
                            <div class="form-group">
                                <label class="form-label">Quiz Title</label>
                                <input type="text" id="quizTitleInput" class="form-control" placeholder="Final Quiz"
                                    required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Passing Score (%)</label>
                                <input type="number" id="quizPassingScore" class="form-control" value="85" min="0"
                                    max="100">
                            </div>

                            <h3 style="margin: var(--space-xl) 0 var(--space-md)">Questions</h3>
                            <div id="quizQuestionsList"></div>

                            <button type="button" class="add-lesson-btn" onclick="addQuizQuestion()"
                                style="margin-bottom:var(--space-lg)">+ Add Question</button>

                            <div class="lesson-actions">
                                <button type="submit" class="btn btn-primary">Save Quiz</button>
                                <button type="button" class="btn btn-danger" onclick="deleteQuiz()">Delete Quiz</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="toastContainer" class="toast-container"></div>

    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/pages/course-editor.js"></script>
    <script src="js/chatbot.js"></script>

    <!-- Mobile Bottom Nav -->
    <nav class="mobile-bottom-nav">
        <a href="explore.html" class="nav-item">
            <span class="nav-icon icon-search"></span>
            <span class="nav-label">Explore</span>
        </a>
        <a href="in-person.html" class="nav-item">
            <span class="nav-icon icon-location"></span>
            <span class="nav-label">In-Person</span>
        </a>
        <a href="learning.html" class="nav-item">
            <span class="nav-icon icon-books"></span>
            <span class="nav-label">My Learning</span>
        </a>
    </nav>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => { });
        }
    </script>
</body>

</html>